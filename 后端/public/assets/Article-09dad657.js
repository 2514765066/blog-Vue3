import{_ as R,a as A,s as N,y as $,N as F,i as S,r as j,c as X,j as k,d as T,e as C,g as Y,f as r,q as y,I as w,l as H,E as B,z as K,t as U,F as V,$ as g,p as q,h as Z}from"./index-32c2b363.js";import{H as z}from"./Header-5cece443.js";import{a as x}from"./useTime-ba59bc9d.js";import{n as G}from"./index.browser-7e542916.js";import"./Waves-18e36e27.js";const W=d=>{let f=d.length;return f>1e3&&(f=(f/1e3).toFixed(1)+"k"),f},J=(d,f,u)=>{try{if(d.nodeName==u)return!0;for(;d.parentElement!=f;)if(d=d.parentNode,d.nodeName==u)return!0;return!1}catch{}};var P;(function(d){var f=function(){function n(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(n.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),n.prototype.clearData=function(t){t!=null?delete this._data[t.toLowerCase()]:this._data={}},n.prototype.getData=function(t){return this._data[t.toLowerCase()]||""},n.prototype.setData=function(t,e){this._data[t.toLowerCase()]=e},n.prototype.setDragImage=function(t,e,a){var s=u._instance;s._imgCustom=t,s._imgOffset={x:e,y:a}},n}();d.DataTransfer=f;var u=function(){function n(){if(this._lastClick=0,n._instance)throw"DragDropTouch instance already created.";var t=!1;if(document.addEventListener("test",function(){},{get passive(){return t=!0,!0}}),navigator.maxTouchPoints){var e=document,a=this._touchstart.bind(this),s=this._touchmove.bind(this),h=this._touchend.bind(this),o=t?{passive:!1,capture:!1}:!1;e.addEventListener("touchstart",a,o),e.addEventListener("touchmove",s,o),e.addEventListener("touchend",h),e.addEventListener("touchcancel",h)}}return n.getInstance=function(){return n._instance},n.prototype._touchstart=function(t){var e=this;if(this._shouldHandle(t)){if(Date.now()-this._lastClick<n._DBLCLICK&&this._dispatchEvent(t,"dblclick",t.target)){t.preventDefault(),this._reset();return}this._reset();var a=this._closestDraggable(t.target);a&&!this._dispatchEvent(t,"mousemove",t.target)&&!this._dispatchEvent(t,"mousedown",t.target)&&(this._dragSource=a,this._ptDown=this._getPoint(t),this._lastTouch=t,t.preventDefault(),setTimeout(function(){e._dragSource==a&&e._img==null&&e._dispatchEvent(t,"contextmenu",a)&&e._reset()},n._CTXMENU),n._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout(function(){e._isDragEnabled=!0,e._touchmove(t)},n._PRESSHOLDAWAIT)))}},n.prototype._touchmove=function(t){if(this._shouldCancelPressHoldMove(t)){this._reset();return}if(this._shouldHandleMove(t)||this._shouldHandlePressHoldMove(t)){var e=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",e)){this._lastTouch=t,t.preventDefault();return}this._dragSource&&!this._img&&this._shouldStartDragging(t)&&(this._dispatchEvent(t,"dragstart",this._dragSource),this._createImage(t),this._dispatchEvent(t,"dragenter",e)),this._img&&(this._lastTouch=t,t.preventDefault(),this._dispatchEvent(t,"drag",this._dragSource),e!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",e),this._lastTarget=e),this._moveImage(t),this._isDropZone=this._dispatchEvent(t,"dragover",e))}},n.prototype._touchend=function(t){if(this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target)){t.preventDefault();return}this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",t.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},n.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2},n.prototype._shouldHandleMove=function(t){return!n._ISPRESSHOLDMODE&&this._shouldHandle(t)},n.prototype._shouldHandlePressHoldMove=function(t){return n._ISPRESSHOLDMODE&&this._isDragEnabled&&t&&t.touches&&t.touches.length},n.prototype._shouldCancelPressHoldMove=function(t){return n._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(t)>n._PRESSHOLDMARGIN},n.prototype._shouldStartDragging=function(t){var e=this._getDelta(t);return e>n._THRESHOLD||n._ISPRESSHOLDMODE&&e>=n._PRESSHOLDTHRESHOLD},n.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new f,clearInterval(this._pressHoldInterval)},n.prototype._getPoint=function(t,e){return t&&t.touches&&(t=t.touches[0]),{x:e?t.pageX:t.clientX,y:e?t.pageY:t.clientY}},n.prototype._getDelta=function(t){if(n._ISPRESSHOLDMODE&&!this._ptDown)return 0;var e=this._getPoint(t);return Math.abs(e.x-this._ptDown.x)+Math.abs(e.y-this._ptDown.y)},n.prototype._getTarget=function(t){for(var e=this._getPoint(t),a=document.elementFromPoint(e.x,e.y);a&&getComputedStyle(a).pointerEvents=="none";)a=a.parentElement;return a},n.prototype._createImage=function(t){this._img&&this._destroyImage();var e=this._imgCustom||this._dragSource;if(this._img=e.cloneNode(!0),this._copyStyle(e,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var a=e.getBoundingClientRect(),s=this._getPoint(t);this._imgOffset={x:s.x-a.left,y:s.y-a.top},this._img.style.opacity=n._OPACITY.toString()}this._moveImage(t),document.body.appendChild(this._img)},n.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},n.prototype._moveImage=function(t){var e=this;requestAnimationFrame(function(){if(e._img){var a=e._getPoint(t,!0),s=e._img.style;s.position="absolute",s.pointerEvents="none",s.zIndex="999999",s.left=Math.round(a.x-e._imgOffset.x)+"px",s.top=Math.round(a.y-e._imgOffset.y)+"px"}})},n.prototype._copyProps=function(t,e,a){for(var s=0;s<a.length;s++){var h=a[s];t[h]=e[h]}},n.prototype._copyStyle=function(t,e){if(n._rmvAtts.forEach(function(E){e.removeAttribute(E)}),t instanceof HTMLCanvasElement){var a=t,s=e;s.width=a.width,s.height=a.height,s.getContext("2d").drawImage(a,0,0)}for(var h=getComputedStyle(t),o=0;o<h.length;o++){var v=h[o];v.indexOf("transition")<0&&(e.style[v]=h[v])}e.style.pointerEvents="none";for(var o=0;o<t.children.length;o++)this._copyStyle(t.children[o],e.children[o])},n.prototype._dispatchEvent=function(t,e,a){if(t&&a){var s=document.createEvent("Event"),h=t.touches?t.touches[0]:t;return s.initEvent(e,!0,!0),s.button=0,s.which=s.buttons=1,this._copyProps(s,t,n._kbdProps),this._copyProps(s,h,n._ptProps),s.dataTransfer=this._dataTransfer,a.dispatchEvent(s),s.defaultPrevented}return!1},n.prototype._closestDraggable=function(t){for(;t;t=t.parentElement)if(t.hasAttribute("draggable")&&t.draggable)return t;return null},n}();u._instance=new u,u._THRESHOLD=5,u._OPACITY=.5,u._DBLCLICK=500,u._CTXMENU=900,u._ISPRESSHOLDMODE=!1,u._PRESSHOLDAWAIT=400,u._PRESSHOLDMARGIN=25,u._PRESSHOLDTHRESHOLD=0,u._rmvAtts="id,class,style,draggable".split(","),u._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),u._ptProps="pageX,pageY,clientX,clientY,screenX,screenY,offsetX,offsetY".split(","),d.DragDropTouch=u})(P||(P={}));const p=d=>(q("data-v-8181b451"),d=d(),Z(),d),Q={class:"v-c-n"},tt={class:"h shadow"},et={class:"v-n-c p-1 f-w"},nt=p(()=>r("i",{class:"fa-solid fa-list"},null,-1)),it=[nt],ot=p(()=>r("i",{class:"fa-solid fa-list-ol"},null,-1)),st=[ot],at=p(()=>r("i",{class:"fa-solid fa-code"},null,-1)),rt=[at],lt=p(()=>r("i",{class:"fa-solid fa-bold"},null,-1)),ut=[lt],ct=p(()=>r("i",{class:"fa-solid fa-italic"},null,-1)),dt=[ct],ht=p(()=>r("i",{class:"fa-solid fa-strikethrough"},null,-1)),_t=[ht],ft=p(()=>r("i",{class:"fa-solid fa-link"},null,-1)),pt=[ft],gt={class:"v-sb-n"},mt={class:"v-c-c mr-1 fs-14"},vt={class:"v-sb-n"},yt={class:"v-n-c"},bt=p(()=>r("i",{class:"fa-solid fa-tags mr-2"},null,-1)),Et=["innerHTML"],Dt={__name:"Article",setup(d){const f=A(),u=N(),n=$(),t=F(),e=u.articles.find(c=>c.id==t.query.id),a=S("#"),s=S(null),h=S(),o=j({id:G(),tag:"",title:"",subtitle:"",text:"",fontCount:0,time:x(),updateTime:x(),bg:"",like:[],msg:[],...e}),v=X(()=>{if(typeof o.bg=="object"&&o.bg.file!="")return window.URL.createObjectURL(o.bg);if(typeof o.bg=="string"&&o.bg!="")return o.bg});function E(c){o.bg=c.target.files[0]}function m(c,i){const _=document.createElement(c);_.innerHTML=i,_.draggable=!0,s.value.appendChild(_)}function D(c){window.getSelection().rangeCount>0&&document.execCommand(c,!1,null)}function I(){const c=window.getSelection(),i=c.getRangeAt(0);if(c.rangeCount>0){const _=document.createElement("a");_.href=a.value,_.contentEditable=!1,_.appendChild(i.extractContents()),i.insertNode(_)}}function L(c){const i=window.getSelection(),_=i.anchorNode;if(J(_,s.value,"PRE")==!1)return;const b=i.getRangeAt(0);let l;switch(c.key){case"Enter":l=document.createTextNode(`
\r`);break;case"{":l=document.createTextNode("{}");break;case"[":l=document.createTextNode("[]");break;case"<":l=document.createTextNode("<>");break;case"(":l=document.createTextNode("()");break;case'"':l=document.createTextNode('""');break;case"'":l=document.createTextNode("''");break;default:return}c.preventDefault(),b.insertNode(l),b.setStartAfter(l)}function O(){if(o.title.trim()==""){g.emit("tipShow",{title:"标题不能为空"});return}if(o.tag.trim()==""){g.emit("tipShow",{title:"标签不能为空"});return}if(s.value.innerText.trim()==""){g.emit("tipShow",{title:"内容不能为空"});return}if(typeof o.bg=="object"){const i=new FormData;i.append("images",o.bg,o.id+".png"),f.postImage(i)}if(o.text=s.value.innerHTML.replace(/ draggable="true"/g,""),o.subtitle=s.value.innerText.replace(/\n/g," ").slice(0,80),o.updateTime=x(),o.fontCount=W(o.subtitle),t.query.id){u.putData(o)&&g.emit("tipShow",{title:"保存成功"});return}u.postData(o)&&(g.emit("tipShow",{title:"保存成功"}),n.push({path:"/edit/article",query:{id:o.id}}))}function M(){g.emit("dialogShow",{title:"提示",subtitle:"你确定要删除这篇文章吗？",func:()=>{u.deleteData(o.id)&&(g.emit("tipShow",{title:"删除成功",type:!0}),n.push({path:"/article"}))}})}return(c,i)=>{const _=k("media"),b=k("drag");return T(),C(V,null,[Y(z,{title:"文章编辑",url:v.value},null,8,["url"]),r("main",Q,[r("section",tt,[r("nav",et,[r("button",{onClick:i[0]||(i[0]=l=>m("h2","标题"))},"标题"),r("button",{onClick:i[1]||(i[1]=l=>m("div","文本"))},"文本"),r("button",{onClick:i[2]||(i[2]=l=>h.value.click())},"背景"),r("input",{type:"file",onChange:E,ref_key:"changeFile",ref:h},null,544),r("button",{onClick:i[3]||(i[3]=l=>m("aside","提示"))},"提示"),r("button",{onClick:i[4]||(i[4]=l=>m("ul","<li>列表</li"))},it),r("button",{onClick:i[5]||(i[5]=l=>m("ol","<li>列表</li"))},st),r("button",{onClick:i[6]||(i[6]=l=>m("pre","代码"))},rt),r("button",{onClick:i[7]||(i[7]=l=>D("bold"))},ut),r("button",{onClick:i[8]||(i[8]=l=>D("italic"))},dt),r("button",{onClick:i[9]||(i[9]=l=>D("strikethrough"))},_t),r("button",{onClick:I},pt),y(r("input",{type:"text","onUpdate:modelValue":i[10]||(i[10]=l=>a.value=l),placeholder:"请输入链接"},null,512),[[w,a.value]])]),r("article",gt,[r("div",null,[r("button",{class:"mr-2 fw-b",onClick:O},"保存"),r("button",{class:"mr-2 fw-b",onClick:i[11]||(i[11]=l=>H(n).back())},"退出"),H(t).query.id?(T(),C("button",{key:0,class:"mr-2 fw-b",onClick:M},"删除")):B("",!0)]),y((T(),C("span",mt,[K(U(o.time),1)])),[[_,480]])]),r("article",vt,[y(r("input",{type:"text",placeholder:"添加文章名称",maxlength:"10","onUpdate:modelValue":i[12]||(i[12]=l=>o.title=l)},null,512),[[w,o.title]]),r("div",yt,[bt,y(r("input",{type:"text",placeholder:"请输入标签",maxlength:"5","onUpdate:modelValue":i[13]||(i[13]=l=>o.tag=l)},null,512),[[w,o.tag]])])]),y(r("div",{contenteditable:"",ref_key:"content",ref:s,onKeydown:L,innerHTML:o.text},null,40,Et),[[b]])])])],64)}}},kt=R(Dt,[["__scopeId","data-v-8181b451"]]);export{kt as default};
